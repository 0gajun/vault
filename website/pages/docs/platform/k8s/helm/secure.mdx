---
layout: docs
page_title: Securing Vault - Kubernetes
sidebar_title: Securing Vault
description: >-
  To run Vault securly within Kubernetes requires you to protect configuration,
  run within the proper accounts, and hardening for production.
---

# Securing Vault on Kubernetes

After Vault is running on Kubernetes it is important to secure the installation
to ensure your configuration and pods are protected.

## Protecting Sensitive Vault Configurations

Vault Helm renders a Vault configuration file during installation and stores the
file in a Kubernetes configmap. Some configurations require sensitive data to be
included in the configuration file and would not be encrypted at rest once
created in Kubernetes.

The following example shows how to add extra configuration files to Vault Helm
to protect sensitive configurations from being in plaintext at rest using
Kubernetes secrets.

First, create a partial Vault configuration with the sensitive settings Vault
loads during startup.

```bash
$ cat <<EOF >>config.hcl
storage "mysql" {
username = "user1234"
password = "secret123!"
database = "vault"
}
EOF
```

Next, create a Kubernetes secret containing this partial configuration.

```bash
$ kubectl create secret generic vault-storage-config \
    --from-file=config.hcl
```

Finally, mount this secret as an extra volume and add an additional `-config`
flag to the Vault startup command.

```bash
$ helm install vault \
  --set='server.extraVolumes[0].type=secret' \
  --set='server.extraVolumes[0].name=vault-storage-config' \
  --set='server.extraArgs=-config=/vault/userconfig/vault-storage-config/config.hcl' .
```

## Architecture

We recommend running Vault on Kubernetes with the same [general
architecture](/docs/internals/architecture) as running it anywhere else. There
are some benefits Kubernetes can provide that eases operating a Vault cluster
and we document those below. The standard [production deployment
guide](https://learn.hashicorp.com/vault/day-one/production-hardening) is still
an important read even if running Vault within Kubernetes.

### Production Deployment Checklist

**End-to-End TLS.** Vault should always be used with TLS in production. If
intermediate load balancers or reverse proxies are used to front Vault,
they should not terminate TLS. This way traffic is always encrypted in transit
to Vault and minimizes risks introduced by intermediate layers. See the
[official documentation](/docs/platform/k8s/helm/examples/standalone-tls/)
for example on configuring Vault Helm to use TLS.

**Single Tenancy.** Vault should be the only main process running on a machine.
This reduces the risk that another process running on the same machine is
compromised and can interact with Vault. This can be accomplished by using Vault
Helm's `affinity` configurable. See the
[official documentation](/docs/platform/k8s/helm/examples/ha-with-consul/)
for example on configuring Vault Helm to use affinity rules.

**Enable Auditing.** Vault supports several auditing backends. Enabling auditing
provides a history of all operations performed by Vault and provides a forensics
trail in the case of misuse or compromise. Audit logs securely hash any
sensitive data, but access should still be restricted to prevent any unintended
disclosures. Vault Helm includes a configurable `auditStorage` option that
provisions a persistent volume to store audit logs. See the [official
documentation](/docs/platform/k8s/helm/examples/standalone-audit/) for an
example on configuring Vault Helm to use auditing.

**Immutable Upgrades.** Vault relies on an external storage backend for
persistence, and this decoupling allows the servers running Vault to be managed
immutably. When upgrading to new versions, new servers with the upgraded version
of Vault are brought online. They are attached to the same shared storage
backend and unsealed. Then the old servers are destroyed. This reduces the need
for remote access and upgrade orchestration which may introduce security gaps.
See the [upgrade section](#how-to) for instructions on upgrading Vault on
Kubernetes.

**Upgrade Frequently.** Vault is actively developed, and updating frequently is
important to incorporate security fixes and any changes in default settings such
as key lengths or cipher suites. Subscribe to the Vault mailing list and
GitHub CHANGELOG for updates.

**Restrict Storage Access.** Vault encrypts all data at rest, regardless of which
storage backend is used. Although the data is encrypted, an attacker with
arbitrary control can cause data corruption or loss by modifying or deleting
keys. Access to the storage backend should be restricted to only Vault to avoid
unauthorized access or operations.
